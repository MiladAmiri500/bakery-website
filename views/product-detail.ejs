<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ayoob Bakery Australia â€” <%= product.name %>
    </title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <%- include('partials/sidebar') %>
        <%- include('partials/category-sidebar') %>
            <%- include('partials/header') %>

                <section class="section product-detail">
                    <div class="breadcrumbs">
                        <a href="/">Home</a> > <a href="/products?category=<%= product.category._id %>">
                            <%= product.category.name %>
                        </a> > <%= product.name %>
                    </div>

                    <div class="product-page-container">
                        <div class="product-gallery">
                            <div class="main-image-container">
                                <img src="<%= product.images[0] %>" alt="<%= product.name %> - Main View"
                                    id="main-product-image" class="main-image">
                            </div>
                            <div class="thumbnail-container">
                                <% product.images.forEach((image, index)=> { %>
                                    <img src="<%= image %>" alt="<%= product.name %> - View <%= index + 1 %>"
                                        class="thumbnail <%= index === 0 ? 'active' : '' %>" data-image="<%= image %>">
                                    <% }) %>
                            </div>
                        </div>

                        <div class="product-info">
                            <h1 class="product-title">
                                <%= product.name %>
                            </h1>

                            <div class="product-rating">
                                <div class="stars">
                                    <% for(let i=1; i <=5; i++) { %>
                                        <i
                                            class="fa<%= product.ratings >= i ? 's' : (product.ratings >= i - 0.5 ? 's fa-star-half-alt' : 'r') %> fa-star"></i>
                                        <% } %>
                                </div>
                                <a href="#reviews" class="rating-count">(<%= product.reviews.length %> Reviews)</a>
                            </div>

                            <p class="product-price">
                                $<%= product.price.toFixed(2) %> / <%= product.unit %>
                            </p>

                            <p class="product-description">
                                <%= product.description || 'No description available.' %>
                            </p>

                            <div class="product-actions">
                                <form action="/cart/add/<%= product._id %>" method="POST">
                                    <div class="quantity-selector">
                                        <button type="button" class="quantity-btn qty-minus">-</button>
                                        <input type="text" id="quantity" name="quantity" value="1" readonly
                                            class="qty-input">
                                        <button type="button" class="quantity-btn qty-plus">+</button>
                                    </div>
                                    <button type="submit" class="btn btn-primary"><i class="fas fa-shopping-cart"></i>
                                        Add to Cart</button>
                                </form>
                                <% if (user) { %>
                                    <form action="/wishlist/add/<%= product._id %>" method="POST">
                                        <button type="submit" class="btn btn-wishlist"><i
                                                class="fas fa-heart <%= isWishlisted ? 'filled' : '' %>"></i></button>
                                    </form>
                                    <% } else { %>
                                        <a href="/login" class="btn btn-wishlist"><i class="fas fa-heart"></i></a>
                                        <% } %>
                            </div>
                        </div>
                    </div>

                    <div class="product-details-sections">
                        <div id="description" class="section-content">
                            <h3>Description</h3>
                            <p>
                                <%= product.description || 'No description available.' %>
                            </p>
                        </div>

                        <div id="features" class="section-content">
                            <h3>Features</h3>
                            <ul>
                                <% product.features.forEach(feature=> { %>
                                    <li>
                                        <%= feature %>
                                    </li>
                                    <% }) %>
                            </ul>
                        </div>

                        <div id="reviews" class="section-content">
                            <h3>Reviews (<%= product.reviews.length %>)</h3>
                            <% if (product.reviews.length===0) { %>
                                <p>No reviews yet.</p>
                                <% } else { %>
                                    <% product.reviews.forEach(review=> { %>
                                        <div class="review">
                                            <div class="review-header">
                                                <span class="review-author">
                                                    <%= review.user %>
                                                </span>
                                                <div class="stars">
                                                    <% for(let i=1; i <=5; i++) { %>
                                                        <i
                                                            class="fa<%= review.rating >= i ? 's' : (review.rating >= i - 0.5 ? 's fa-star-half-alt' : 'r') %> fa-star"></i>
                                                        <% } %>
                                                </div>
                                                <span class="review-date">
                                                    <%= new Date(review.date).toLocaleDateString() %>
                                                </span>
                                            </div>
                                            <p class="review-body">
                                                <%= review.comment %>
                                            </p>
                                        </div>
                                        <% }) %>
                                            <% } %>

                                                <div class="review-form">
                                                    <h3>Add Your Review</h3>
                                                    <form
                                                        action="<%= user ? '/product/' + product._id + '/review' : '/login' %>"
                                                        method="<%= user ? 'POST' : 'GET' %>">
                                                        <div class="form-group">
                                                            <label for="comment">Your Review</label>
                                                            <textarea id="comment" name="comment" class="form-control"
                                                                placeholder="Share your thoughts..."
                                                                required></textarea>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="rating">Rating</label>
                                                            <select id="rating" name="rating" class="form-control"
                                                                required>
                                                                <option value="5">5 Stars - Excellent</option>
                                                                <option value="4">4 Stars - Good</option>
                                                                <option value="3">3 Stars - Average</option>
                                                                <option value="2">2 Stars - Fair</option>
                                                                <option value="1">1 Star - Poor</option>
                                                            </select>
                                                        </div>
                                                        <button type="submit" class="btn btn-submit">Submit
                                                            Review</button>
                                                    </form>
                                                </div>
                        </div>
                    </div>

                    <!-- Related Products Section -->
                    <section class="related-products">
                        <h3>Related Products</h3>
                        <div class="swiper relatedSwiper">
                            <div class="swiper-wrapper">
                                <% relatedProducts.forEach(related=> { %>
                                    <div class="swiper-slide">
                                        <%- include('partials/product-card', { product: related, isWishlisted: user ?
                                            user.wishlist.includes(related._id) : false, quantity: 1 }) %>
                                    </div>
                                    <% }) %>
                            </div>
                        </div>
                    </section>
                </section>

                <%- include('partials/footer') %>

                    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
                    <script src="/js/scripts.js"></script>
</body>

</html>