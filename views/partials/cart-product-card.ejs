<div class="product-card" style="position: relative;">
    <div class="product-card-image" style="position: relative;">
        <!-- Trash form (wishlist classes removed) -->
        <form action="/cart/remove/<%= index %>" method="POST" class="trash-form"
            style="margin:0; position: absolute; top: 15px; right: 15px; z-index: 10;">
            <button type="submit" class="trash-icon btn-trash-cart" aria-label="Remove from cart">
                <i class="fas fa-trash"></i>
            </button>
        </form>
        <img src="<%= product.images && product.images.length > 0 ? product.images[0] : '' %>"
            alt="<%= product.name %>">
        <% if (product.sale) { %>
            <div class="product-badge sale">Sale</div>
            <% } %>
    </div>
    <div class="product-card-info">
        <div class="product-category">
            <%= product.category ? product.category.name : 'Uncategorized' %>
        </div>
        <h3 class="product-title"><a href="/product/<%= product._id %>">
                <%= product.name %>
            </a></h3>
        <div class="product-rating">
            <% for(let i=0; i < 5; i++) { %>
                <i
                    class="fa<%= product.ratings > i ? (product.ratings > i + 0.5 ? 's fa-star' : 's fa-star-half-alt') : 'r fa-star' %>"></i>
                <% } %>
        </div>
        <div class="product-price-container">
            <span class="product-price">$<%= product.price.toFixed(2) %></span>
            <span class="price-unit"> / <%= product.unit %></span>
        </div>
        <!-- Quantity/Weight display (clickable to edit) -->
        <div class="quantity-display" data-index="<%= index %>" data-unit="<%= product.unit %>"
            data-quantity="<%= quantity %>">
            <%= product.unit==='quantity' ? 'Quantity' : 'Weight' %>: <%= quantity %>
                    <%= product.unit %>
        </div>
        <!-- Hidden edit form (toggled by JS) -->
        <form action="/cart/update/<%= index %>" method="POST" class="quantity-edit-form"
            style="display: none; margin-top: 10px;">
            <% if (product.unit==='quantity' ) { %>
                <div class="quantity-selector">
                    <button type="button" class="qty-btn qty-btn-minus" aria-label="Decrease quantity" <%=quantity <=1
                        ? 'disabled' : '' %>>-</button>
                    <input type="number" class="qty-input" name="quantity" value="<%= quantity %>" min="1" step="1">
                    <button type="button" class="qty-btn qty-btn-plus" aria-label="Increase quantity">+</button>
                </div>
                <% } else { %>
                    <div class="weight-selector">
                        <input type="number" class="qty-input weight-input" name="quantity" value="<%= quantity %>"
                            min="0.1" step="0.1">
                        <span class="unit-label">
                            <%= product.unit %>
                        </span>
                    </div>
                    <% } %>
                        <button type="submit" class="btn-update-quantity">Update</button>
                        <button type="button" class="btn-cancel-edit">Cancel</button>
        </form>
        <!-- Order Now button -->
        <a href="#" class="btn-order-now">Order Now</a>
    </div>
</div>